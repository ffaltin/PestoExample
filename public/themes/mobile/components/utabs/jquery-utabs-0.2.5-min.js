/**
 * A simple tabber system for those who hate jQuery UI :-)
 *
 * Author: Max Ruman <m@rmx.cc>
 * License: GPLv3
 */

(function(e){e.fn.uTabs=function(t){var n={onSwitch:function(){},ajaxOnLoad:function(){},ajaxReload:!0,classes:{nav:"",ul:"",li:"",liCurrent:""}},r=this,t=e.extend(n,t),i={},s=function(n){var s=n.parent("ul").find("li");s.removeClass("current"),s.removeClass(t.classes.liCurrent),n.addClass("current"),n.addClass(t.classes.liCurrent);var o=n.find("a"),u=e(o.attr("href")),a=u.attr("id");r.find("section").removeClass("__current"),u.addClass("__current"),void 0!==o.attr("data-href")&&(t.ajaxReload||!i.hasOwnProperty(a))&&e.ajax({url:o.attr("data-href"),cache:!t.ajaxReload,dataType:"html",success:function(e){u.html(e),i[a]=(new Date).getTime(),t.ajaxOnLoad(u)}}),u.length&&(s.find("a").each(function(t,n){var n=e(n),r=void 0!==n.attr("data-target")?e(n.attr("data-target")):e(n.attr("href"));r.hide()}),t.onSwitch(u),u.show())},o=function(t){var n=e(this).parent("li");s(n),t.preventDefault()},u=function(n){n.off("click",o),n.find("nav").remove(),n.each(function(n,r){var r=e(r),i=e(document.createElement("ul")).prependTo(r).wrap(document.createElement("nav"));i.parent("nav").addClass(t.classes.nav),i.addClass(t.classes.ul),r.find("> section").each(function(n,r){var r=e(r),s=e(document.createElement("a")).attr("href","#"+r.attr("id")).text(r.attr("data-label"));void 0!==r.attr("data-href")&&s.attr("data-href",r.attr("data-href")),s.appendTo(i).wrap(document.createElement("li")),s.parent("li").addClass(t.classes.li)})}),n.each(function(t,n){var n=e(n),r={};r.first=n.find("> nav ul li:first"),r.current=n.find("> nav ul li.current")||n.find("> nav ul li:first");if(!r.current.length){var i=n.find("> section.__current");i.length?r.current=n.find("> nav ul li a[href=#"+i.attr("id")+"]").parent("li"):r.current=r.first}s(r.current)}),n.find("> nav ul li a").on("click",o)};u(r),r.on("DOMNodeInserted DOMNodeRemoved",function(e){e.relatedNode==r.get(0)&&e.target.nodeName.toLowerCase()=="section"&&setTimeout(function(){u(r)},0)})}})(jQuery);
